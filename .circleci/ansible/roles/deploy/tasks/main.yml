---
- name: Creates web directory
  become: yes
  file:
    path: ~/udapeople
    state: directory

- name: copy web server files
  become: yes
  copy:
    src: artifact.tar.gz
    dest: ~/udapeople/artifact.tar.gz

- name: extract server files
  become: yes
  shell: tar -xvzf ~/udapeople/artifact.tar.gz -C ~/udapeople/

- name: install deps
  become: yes
  shell: cd ~/udapeople/ && npm install

- name: view directory
  become: yes
  shell: chdir="~/udapeople/" ls -la
  register: dir_structure
  tags: t1

- name: stop any other pm2 server and start web server
  become: yes
  shell: (cd ~/udapeople/ && pm2 stop default); (cd ~/udapeople/ && pm2 start npm -- start)
  register: result
  tags: t2

- debug:
    var: dir_structure.stdout
  tags: always
- debug:
    var: result.stdout
  tags: always
